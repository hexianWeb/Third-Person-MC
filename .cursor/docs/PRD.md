# PRD —— 魂类锁定敌人预热体验

## 1. 产品概述与目标
- **定位**：利用 Three.js 搭建的网页演示，展示 MC 风格地牢与魂类锁定战斗氛围，作为正式游戏发售前的预热入口。
- **体验流程**：用户进入页面 → Steve 自动沿地牢通道前进（可用 WASD 微调） → 遇敌锁定并进入回合制战斗演示 → 弹出伪购买页引导点击。
- **成功指标**：平均停留 ≥1 分钟、战斗演示完成率 ≥80%、点击购买 CTA ≥30%。

## 2. 目标受众
- 原游戏粉丝，熟悉魂类玩法与 MC 美术，主要使用 PC 端 Chrome 浏览器。
- 期待提前感受正式作品的画面、手感与世界观，以判断是否购买。

## 3. 核心功能与验收标准
1. **线性地牢行进**
   - Blender 产出的地牢模型导入 Three.js，Steve 面朝 -Z 自动向前，玩家可用 WASD/方向键作小范围左右/前后调整。
   - 地形碰撞与导航限制玩家偏离主线路，确保 10 秒内必然触发遭遇战。
   - **验收**：无穿模/卡死，镜头平滑跟随，触发战斗点可重复测试。
2. **魂类锁定战斗（回合制脚本）**
   - 进入战斗后自动锁定怪物，镜头切入战斗构图，按脚本交替播放攻击、防御、受击动画与音效。
   - 至少包含 3 个回合（玩家与怪物交替），HP 条同步扣减。
   - **验收**：锁定指示器可见，动画/伤害/UI 更新一致，无跳帧或状态错乱。
3. **HUD / UI**
   - 左下展示玩家血量、食物或能量条；右下展示技能/物品菱形布局；屏幕底部显示当前操作提示（例如 “按 Y 攻击”）。
   - UI 颜色、图标可通过简易配置调整，战斗阶段 0.5 s 内加载完成。
   - **验收**：在 1280–1920 分辨率保持清晰，提示文字阶段切换无重叠。
4. **交互提示与输入**
   - 探索阶段显示 WASD 提示，战斗阶段切换为回合指令说明；输入逻辑支持键盘拓展。
   - **验收**：提示与状态机同步切换，按键响应延迟 <50 ms。
5. **伪购买页 CTA**
   - 战斗结束自动弹出模态或卡片，包含产品描述、价格/折扣、CTA 按钮（可链接到真实商店或信息弹层）。
   - **验收**：CTA 可点击、可关闭返回演示重播；点击事件可通过埋点统计。

## 4. 技术栈与实现建议
- **渲染框架**：Vite + Three.js（ES Modules）。若已有 Vue/React HUD，可复用现有栈。
- **场景资产**：Blender 导出 glTF/GLB，在 `src/js/sources.js` 声明统一加载；大型模型建议开启 Draco 压缩与纹理解压缓存。
- **输入/状态管理**：自定义 Input 模块 + Experience 单例；战斗逻辑建议使用有限状态机（探索 / 过渡 / 战斗 / CTA）。
- **部署**：Vercel 静态托管，启用 gzip/HTTP2，必要时添加 Loading 过渡以隐藏首屏加载。
- **监控（可选）**：Vercel Analytics 或轻量埋点，仅记录 CTA 点击与演示完成率。

## 5. 概念数据模型（内存态）
| 实体 | 字段 | 说明 |
| --- | --- | --- |
| `PlayerState` | `position(vec3)`、`direction(vec3)`、`hp(int)`、`status('explore'/'battle')`、`selectedSkill(id)` | 驱动角色动画与 UI 的实时状态 |
| `EnemyState` | `id`、`hp(int)`、`patternScript(array)`、`currentTurn(int)` | 控制怪物血量与回合脚本 |
| `BattleTurn` | `attacker('player'/'enemy')`、`damage(int)`、`animationKey(string)`、`delay(ms)` | 回合制驱动指令 |
| `UIContext` | `phase('explore'/'battle'/'cta')`、`promptText`、`inventoryIcons[]` | HUD 渲染条件 |
| `PurchaseCTA` | `title`、`description`、`ctaUrl`、`buttonText` | 伪购买页展示内容 |

> 数据不做持久化，玩家关闭页面即清空；无需账号体系。

## 6. UI 设计原则与描述
- **沉浸感**：暗色石砖背景+体积雾，UI 使用像素化描边、半透明背景。
- **层级清晰**：血条 > 技能图标 > 提示文字，避免遮挡角色。
- **阶段色彩**：探索时 HUD 色温偏冷，战斗时加入红/紫强调；CTA 模块使用较亮的对比色吸引点击。
- **动效**：HP 扣减、技能冷却有平滑过渡；锁定标记持续 pulsate。
- **流程示意**：`加载页 → 探索（WASD 提示） → 触发锁定（镜头拉近） → 回合制演示 → CTA 弹窗/跳转`。

## 7. 安全与可靠性
- 资源文件采用 hash 命名，防止缓存污染或篡改。
- 启用基础 CSP（`default-src 'self'`），仅放行必要的 CDN/字体。
- 输入监听限制在 canvas 或窗口焦点，避免记录无关键位。
- 战斗脚本运行前校验 turn 数组，防止脚本错误导致死循环。

## 8. 开发阶段与里程碑
1. **地牢与移动（1 周）**
   - 导入地牢模型、烘焙灯光/阴影、搭建自动前进 + 偏移逻辑。
   - 添加碰撞体或导航线，验证 10 秒触发战斗点。
2. **战斗演示与 HUD（1.5 周）**
   - 实现锁定镜头、回合制状态机、动画/音效联动。
   - 构建血条、技能、提示 UI，并与状态机同步。
3. **CTA 与打磨（0.5 周）**
   - 伪购买页、重播机制、点击统计。
   - 性能优化（资源压缩、延迟加载）与 QA。

每阶段结尾进行体验评审与缺陷清单，阻断问题需在进入下一阶段前关闭。

## 9. 潜在挑战与应对
- **玩家移动逻辑**：自动前进与手动偏移容易冲突 → 使用路径插值 + 偏移限制，检测墙体后平滑回正。
- **魂类锁定镜头**：突然切换易晕 → 预设 Camera Rig，使用缓动函数和过渡时间 ≥0.4 s。
- **回合同步**：动画/伤害/音效可能错位 → 建立统一的 `BattleTurnController`，按事件驱动 UI 与音效。
- **大模型加载**：首次进入可能卡顿 → 采用懒加载/Loading 画面，并在后台预热战斗资源。

## 10. 未来扩展
- 增加不同怪物、技能或多段演示，提高重复游玩价值。
- 引入排行榜、打卡、邮箱订阅等转化组件。
- 支持社交分享、一键跳转至正式商店或激活码兑换。
- 结合 WebGPU、屏幕空间特效提升视觉冲击。
- 增加多语言文本、音频切换以覆盖更多市场。

---

请在实现过程中根据 Three.js 框架规范，保持 Experience 单例的依赖获取方式，并为新增组件添加中文调试注释与控制面板，确保与现有代码风格一致。文件如需更新请同步版本管理与测试。
